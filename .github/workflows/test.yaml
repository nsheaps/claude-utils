name: Test

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check bash syntax
        run: |
          for script in bin/*; do
            # Skip directories (like bin/lib/)
            [[ -d "$script" ]] && continue
            echo "Checking $script..."
            bash -n "$script"
          done
          # Also check library files
          for lib in bin/lib/*.sh; do
            echo "Checking $lib..."
            bash -n "$lib"
          done
          echo "All scripts passed syntax check."

  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup mise
        uses: jdx/mise-action@v3

      - name: Install test dependencies
        run: |
          # Install fzf for cc-resume
          sudo apt-get update
          sudo apt-get install -y fzf

      - name: Run tests
        run: mise run test
